import{c as t}from"./p-112455b1.js";import{P as i,c as s}from"./p-e908516f.js";import{r as n,f as e}from"./p-a1835bb8.js";function o(t,i){this._target=t||document.body,this._attr=i||"data-focus-method",this._focusMethod=this._lastFocusMethod=!1,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this),this._onWindowBlur=this._onWindowBlur.bind(this),this._bindEvents()}var r=o.prototype;r._bindEvents=function(){this._target.addEventListener("keydown",this._onKeyDown,!0),this._target.addEventListener("mousedown",this._onMouseDown,!0),this._target.addEventListener("touchstart",this._onTouchStart,!0),this._target.addEventListener("focus",this._onFocus,!0),this._target.addEventListener("blur",this._onBlur,!0),window.addEventListener("blur",this._onWindowBlur)},r._onKeyDown=function(){this._focusMethod="key"},r._onMouseDown=function(){"touch"!==this._focusMethod&&(this._focusMethod="mouse")},r._onTouchStart=function(){this._focusMethod="touch"},r._onFocus=function(t){this._focusMethod||(this._focusMethod=this._lastFocusMethod),t.target.setAttribute(this._attr,this._focusMethod),this._lastFocusMethod=this._focusMethod,this._focusMethod=!1},r._onBlur=function(t){t.target.removeAttribute(this._attr)},r._onWindowBlur=function(){this._focusMethod=!1};var h=o,c=t((function(t,i){Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,i){var s=this;void 0===t&&(t=[]),this._eventRegistry={},t.forEach((function(t){s._eventRegistry[t]=[]})),i&&i.namespace&&(this.dispatchNamespace="com.apple."+i.namespace),this.shouldStorageDispatch&&window.addEventListener("storage",this._handleGlobalStorageEvent)}return Object.defineProperty(t.prototype,"shouldStorageDispatch",{get:function(){return"undefined"!=typeof window&&"undefined"!=typeof sessionStorage&&this.dispatchNamespace},enumerable:!0,configurable:!0}),t.prototype.addEventListener=function(t,i){Array.isArray(this._eventRegistry[t])&&this._eventRegistry[t].push(i)},t.prototype.dispatchEvent=function(t,i){Array.isArray(this._eventRegistry[t])&&this._eventRegistry[t].forEach((function(t){return t(i)}))},t.prototype.dispatchDistributedEvent=function(t,i){this.dispatchEvent(t,i),this.shouldStorageDispatch&&sessionStorage.setItem(this.dispatchNamespace+":"+t,JSON.stringify(i))},t.prototype.removeEventListener=function(t,i){if(Array.isArray(this._eventRegistry[t])){var s=this._eventRegistry[t].indexOf(i);this._eventRegistry[t].splice(s,1)}},t.prototype._handleGlobalStorageEvent=function(t){var i;if(this.dispatchNamespace&&(null===(i=t.key)||void 0===i?void 0:i.startsWith(this.dispatchNamespace+":"))){var s=t.key.substring(this.dispatchNamespace.length+1);this.dispatchEvent(s,JSON.parse(t.newValue))}},t}();i.Notifications=s}));const a={ADD_TO_LIBRARY:"addToLibrary",COPY_EMBED:"copyEmbed",COPY_LINK:"copyLink",DISPLAYED_PLAYER:"displayedPlayer",DISPLAYED_PLAY:"displayedPlay",OPEN_IN_NEW_WINDOW:"openInNewWindow",OPEN_NATIVE:"openNative",SELECT_TRACK:"selectTrack",TRIGGER_PAUSE:"triggerPause",TRIGGER_PLAY:"triggerPlay",TRIGGER_SKIP:"triggerSkip",TRIGGER_SEEK_START:"triggerSeekStart",TRIGGER_SEEK_END:"triggerSeekEnd",TRIGGER_SHARE:"triggerShare"};class u extends c.Notifications{constructor(){super(Object.values(a)),this._metricsContext={appVersion:"1.2136.1",pageUrl:window.location.href}}initialize(t,i,s={}){this.musicKit=i,this._metricsContext=Object.assign(Object.assign({},this.metricsContext),s)}dispatchMetricsMediaTimedEvent(t,i){if(!this.musicKit)return;const s=Object.assign(Object.assign({},{position:this.musicKit.currentPlaybackTime}),i);this.dispatchMetricsMediaEvent(t,s)}dispatchMetricsMediaEvent(t,s){if(!this.musicKit)return;const n=this.musicKit.nowPlayingItem,e={id:this.metricsContext.itemId,type:this.metricsContext.itemType};null!=n&&(e.id=n.id,e.type=n.type);const o=Object.assign(Object.assign({},e),s);o.type="podcast-episodes"===o.type?i.episode:o.type,this.dispatchMetricsEvent(t,o)}dispatchMetricsEvent(t,i){const s=Object.assign(Object.assign({},this.metricsContext),i);this.dispatchEvent(t,s)}get metricsContext(){return this._metricsContext}}let d=[],f=[],w=[];const l=t=>{if(!window.hasOwnProperty("MusicKit"))throw new Error("MusicKit has not been initialized");return void 0!==t?window.MusicKit.getInstance(t):window.MusicKit.getInstance()},p=t=>y(t,(()=>{if(0===d.length&&window.MusicKit){const{loading:t}=window.MusicKit.PlaybackStates;d=[t]}return d})()),g=(t,i=!0)=>y(t,i?(()=>{if(0===w.length&&window.MusicKit){const{paused:t,playing:i,seeking:s,waiting:n}=window.MusicKit.PlaybackStates;w=[t,i,s,n]}return w})():(()=>{if(0===f.length&&window.MusicKit){const{playing:t,seeking:i,waiting:s}=window.MusicKit.PlaybackStates;f=[t,i,s]}return f})()),y=(t,i)=>-1!==i.indexOf(t.playbackState),E=()=>({}),m=()=>Promise.resolve();function b(t,i){const s=t.componentWillLoad||m,n=t.disconnectedCallback||E,e=function(t){this[i]=t.detail.layout};let o,r;t.componentWillLoad=async function(){return r=await P(this.el||this.element,"playerState"),r&&r.componentRoot&&(this[i]=r.layout,o=e.bind(this),r.componentRoot.addEventListener("layoutChange",o)),s.call(this)},t.disconnectedCallback=async function(){return r&&r.componentRoot&&r.componentRoot.removeEventListener("layoutChange",o),n.call(this)}}function v(t,i){const s=t.componentWillLoad||E;t.componentWillLoad=async function(){await s.call(this),new h(this[i].shadowRoot||this[i])}}function O(t){return function(i){const s=i.componentWillLoad||m;i.componentWillLoad=async function(){const i=await P(this.el||this.element,t);return this[t]=i,s.call(this)}}}async function P(t,i){const s=e(t,i);if(s)return s;const n=t.parentNode;if(n){if(n.host)return P(n.host,i);if(n!==document)return P(n,i)}}function S(t=!1,i){return function(e){const o=e.componentWillLoad,r=function(){return Promise.resolve(o.call(this))};e.componentWillLoad=async function(){const e=void 0!==this.waitForInstance?!this.waitForInstance:t;try{await new Promise((t=>{if(window.MusicKit)return t(window.MusicKit);document.addEventListener("musickitloaded",(()=>{t(window.MusicKit)}))}));const t=await((t=!1,i={developerToken:s.musicToken})=>new Promise((s=>{const{getInstances:n,getInstance:e,configure:o}=window.MusicKit;return n().length>0?s(e()):t?s(o(i)):void document.addEventListener("musickitconfigured",(()=>{s(window.MusicKit.getInstance())}))})))(e,i);this.musicKit=t,n(this.el,"musicKit",t),await r.call(this)}catch(o){this.error=o}}}}function _(){return function(t){const i=t.componentWillLoad,s=function(){return Promise.resolve(i.call(this))};t.componentWillLoad=async function(){let t=await P(this.el||this.element,"metrics");return void 0===t&&(t=new u),this.metrics=t,s.call(this)}}}const R=()=>(t,i,s)=>{if(void 0===s||"function"!=typeof s.value)throw new TypeError(`Only methods can be decorated with @Bind, but ${i} is not a method.`);return{configurable:!0,get(){const t=s.value.bind(this);return Object.defineProperty(this,i,{value:t,configurable:!0,writable:!0}),t}}};export{R as B,a as E,v as F,b as L,S as M,O as S,u as a,p as b,_ as c,l as g,g as p}